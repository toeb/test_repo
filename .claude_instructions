# Claude Instructions

This repository is a tech demo and playground for Toeb Software Platform (TSP).

## Purpose
This file provides guidance and context for Claude Code when working in this repository.

## Repository Structure

### Folder Organization
- `docs/` - Documentation, architecture diagrams, and guides
- `src/` - Source code for all projects (flat structure)
  - All projects (DLLs, EXEs, modules) live as direct subdirectories of `src/`
  - Dotfiles (.editorconfig, .gitignore, etc.) are directly in `src/` and must stay compatible across all projects

### Tech Stacks
This repository contains projects using multiple technology stacks:
- **C# (Desktop & Web)**: .NET projects multi-targeting .NET 8.0 and .NET Framework 4.8
- **C++**: Build system TBD
- **Python**: Project structure TBD

### .NET Projects

#### Naming Conventions
- Use C# typical naming conventions (PascalCase)
- Root namespace: `Tsp` (Toeb Software Platform)
- Examples:
  - `Tsp.Core` - Core library
  - `Tsp.Core.Tests` - Test project for Core
  - `Tsp.Cli` - Command-line application

#### Project Configuration
- **Target Frameworks**: Multi-target `net8.0` and `net48`
- **Solution Format**: Use `.slnx` (new XML-based solution format)
- **Testing Framework**: xUnit
- **Project Style**: Minimal scaffolding

#### Build & Dependencies
- All C# projects use SDK-style project files
- Centralized package management via Directory.Build.props (if needed)

### Build & CI Approach

#### Local-First Philosophy
- **All CI operations must be runnable locally** using the same scripts
- CI workflows call PowerShell scripts from `src/Infrastructure/`
- No "CI magic" - everything is transparent and reproducible locally
- Enables easy debugging of CI failures

#### Infrastructure Scripts
Located in `src/Infrastructure/`, all scripts use **PowerShell 7 (pwsh)** for cross-platform compatibility:
- `ci.ps1` - Complete CI pipeline (restore, build, test)
- `restore.ps1` - Restore NuGet packages
- `build.ps1` - Build all projects
- `test.ps1` - Run all tests
- `clean.ps1` - Clean build artifacts

#### CI Configuration
- **Platform**: GitHub Actions
- **Triggers**: Pull requests
- **Runners**:
  - Windows (builds all frameworks: net8.0 + net48)
  - Linux (builds net8.0 only)
- **Workflow**: `.github/workflows/pr-build.yml` calls Infrastructure scripts

## Git Workflow & Branching Strategy

### Branching Strategy
- **Main Branch**: Protected, requires PR approval and passing CI
- **Feature Branches**: Short-lived, single-purpose branches
  - Branch naming: Use descriptive names (e.g., `feature/add-logging`, `fix/null-reference`)
  - Keep branches focused and small
  - Delete after merge

### Pull Request Requirements
- **Every PR must have an associated GitHub Issue**
- Link the issue in the PR description (e.g., "Closes #123")
- PR must pass all CI checks before merging
- Main branch protection is enforced

### Branch Protection Rules
- Direct commits to `main` are not allowed
- All changes must go through PR process
- CI must pass before merge
- Code review may be required (repository settings dependent)

## Documentation Requirements

### Architecture Decision Records (ADRs)
- All major architectural decisions must be documented in `docs/adr/`
- Use the ADR template format (see `docs/adr/0000-template.md`)
- ADRs are immutable once accepted - create new ADRs to supersede old ones

### Keeping Instructions Updated
- When making general rules or conventions, update `.claude_instructions`
- When making architectural decisions, create an ADR in `docs/adr/`
- Keep all documentation synchronized with actual implementation

## Guidelines
- Follow best practices for code quality and maintainability
- Write clear, descriptive commit messages
- Test changes before committing
- Keep the repository organized and well-documented
- Maintain compatibility of dotfiles across all projects in src/
